<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>- · Gtk.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link href="../../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><a href="../../"><img class="logo" src="../../assets/logo.png" alt="Gtk.jl logo"/></a><h1>Gtk.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../../">Home</a></li><li><span class="toctext">Manual</span><ul><li><a class="toctext" href="../../manual/gettingStarted/">Getting Started</a></li><li><a class="toctext" href="../../manual/properties/">Properties</a></li><li><a class="toctext" href="../../manual/layout/">Layout</a></li><li><a class="toctext" href="../../manual/signals/">Signals and Callbacks</a></li><li><a class="toctext" href="../../manual/builder/">Builder and Glade</a></li><li><a class="toctext" href="../../manual/textwidgets/">Text Widgets</a></li><li><a class="toctext" href="../../manual/combobox/">Combobox</a></li><li><a class="toctext" href="../../manual/listtreeview/">List and Tree Widgets</a></li><li><a class="toctext" href="../../manual/filedialogs/">Dialogs</a></li><li><a class="toctext" href="../../manual/keyevents/">Key Events</a></li><li><a class="toctext" href="../../manual/canvas/">Drawing on Canvas</a></li><li><a class="toctext" href="../../manual/customWidgets/">Custom/Composed Widgets</a></li><li><a class="toctext" href="../../manual/async/">Asynchronous UI</a></li><li><a class="toctext" href="../../manual/nonreplusage/">Non REPL Usage</a></li><li><a class="toctext" href="../../manual/packages/">High-Level Packages</a></li></ul></li></ul></nav><article id="docs"><header><nav><ul><li><a href>-</a></li></ul><a class="edit-page" href="https://github.com/JuliaGraphics/Gtk.jl/blob/master/docs/src/doc/more_signals.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>-</span><a class="fa fa-bars" href="#"></a></div></header><h3><a class="nav-anchor" id="More-about-signals-and-signal-handlers-1" href="#More-about-signals-and-signal-handlers-1">More about signals and signal-handlers</a></h3><p>In addition to the &quot;simple&quot; interface, <code>signal_connect</code> supports an approach that allows your callback function to be directly compiled to machine code.  Not only is this more efficient, but it can occasionally be useful in avoiding problems (see issue #161).</p><p>This alternative syntax is as follows:</p><pre><code class="language-none">signal_connect(cb, widget, signalname, return_type, parameter_type_tuple, after, user_data=widget)</code></pre><p>where:</p><ul><li><code>cb</code> is your callback function. This will be compiled with <code>@cfunction</code>, and you need to follow its rules. In particular, you should use a generic function (i.e., one defined as <code>function foo(x,y,z) ... end</code>), and the arguments and return type should match the GTK+ documentation for the widget and signal (<a href="https://developer.gnome.org/gtk3/stable/GtkWidget.html#GtkWidget-accel-closures-changed">see examples</a>). <strong>In contrast with the simpler interface, when writing these callbacks you must include the <code>user_data</code> argument</strong>.  See examples below.</li><li><code>widget</code> is the widget that will send the signal</li><li><code>signalname</code> is a string or symbol identifying the signal, e.g., <code>&quot;clicked&quot;</code> or <code>&quot;button-press-event&quot;</code></li><li><code>return_type</code> is the type of the value returned by your callback. Usually <code>Nothing</code> (for <code>void</code>) or <code>Cint</code> (for <code>gboolean</code>)</li><li><code>parameter_type_tuple</code> specifies the types of the <em>middle</em> arguments to the callback function, omitting the first (the widget) and last (<code>user_data</code>).  For example, for <a href="https://developer.gnome.org/gtk3/stable/GtkButton.html#GtkButton-clicked"><code>&quot;clicked&quot;</code></a> we have <code>parameter_type_tuple = ()</code> (because there are no middle arguments) and for <a href="https://developer.gnome.org/gtk3/stable/GtkWidget.html#GtkWidget-button-press-event"><code>&quot;button-press-event&quot;</code></a> we have <code>parameter_type_tuple = (Ptr{GdkEventButton},)</code>.</li><li><code>after</code> is a boolean, <code>true</code> if you want your callback to run after the default handler for your signal. When in doubt, specify <code>false</code>.</li><li><code>user_data</code> contains any additional information your callback needs to operate.  For example, you can pass other widgets, tuples of values, etc.  If omitted, it defaults to <code>widget</code>.</li></ul><p>The callback&#39;s arguments need to match the GTK documentation, with the exception of the <code>user_data</code> argument. (Rather than being a pointer, <code>user_data</code> will automatically be converted back to an object.)</p><p>For example, consider a GUI in which pressing a button updates a counter:</p><pre><code class="language-jl">box = @Box(:h)
button = @Button(&quot;click me&quot;)
label  = @Label(&quot;0&quot;)
push!(box, button)
push!(box, label)
win = @Window(box, &quot;Callbacks&quot;)
showall(win)

const counter = [0]  # Pack counter value inside array to make it a reference

# &quot;clicked&quot; callback declaration is
#     void user_function(GtkButton *button, gpointer user_data)
# But user_data gets converted into a Julia object automatically
function button_cb(widgetptr::Ptr, user_data)
     widget = convert(Button, widgetptr)  # pointer -&gt; object
     lbl, cntr = user_data                # unpack the user_data tuple
     cntr[] = cntr[]+1                    # increment counter[1]
     set_gtk_property!(lbl, :label, string(cntr[]))
     nothing                              # return type is void
end

signal_connect(button_cb, button, &quot;clicked&quot;, Nothing, (), false, (label, counter))</code></pre><p>You should note that the value of <code>counter[]</code> matches the display in the GUI.</p><h4><a class="nav-anchor" id="Specifying-the-event-type-1" href="#Specifying-the-event-type-1">Specifying the event type</a></h4><p>If your callback function takes an <code>event</code> argument, it is important to declare its type correctly. An easy way to do that is to first write a callback using the &quot;simple&quot; interface, e.g.,</p><pre><code class="language-jl">    signal_connect(win, &quot;delete-event&quot;) do widget, event
        @show typeof(event)
        @show event
    end</code></pre><p>and then use the reported type in <code>parameter_type_tuple</code>.</p><h4><a class="nav-anchor" id="@guarded-1" href="#@guarded-1"><code>@guarded</code></a></h4><p>The &quot;simple&quot; callback interface includes protections against corrupting Gtk state from errors, but this <code>@cfunction</code>-based approach does not. Consequently, you may wish to use <code>@guarded</code> when writing these functions. (<a href="../../manual/canvas/">Canvas</a> draw functions and mouse event-handling are called through this interface, which is why you should use <code>@guarded</code> there.) For functions that should return a value, you can specify the value to be returned on error as the first argument. For example:</p><pre><code class="language-jl">    const unhandled = convert(Int32, false)
    @guarded unhandled function my_callback(widgetptr, ...)
        ...
    end</code></pre><footer><hr/></footer></article></body></html>
